REM   Script: WEEK 5
REM   WEEK 5 CODES DBS LAB

5.1

SELECT DISTINCT(NAME) FROM EMP WHERE DESIGNATION = (SELECT DESIGNATION FROM EMP WHERE EMPCODE = 101);

5.2

SELECT NAME FROM EMP WHERE REPORTS_TO = (SELECT EMPCODE FROM EMP WHERE NAME = 'Vijay');

5.3

SELECT E.NAME, E.DESIGNATION, E.EMAIL
FROM EMPL E
JOIN WORK_EXP1 WE ON E.EMPCODE = WE.EMPCODE
WHERE WE.PRJID IN (SELECT PRJID FROM WORK_EXP1 WHERE EMPCODE = (SELECT EMPCODE FROM EMPL WHERE NAME = 'VIJAY'));

5.4

SELECT NAME FROM FAMILY_DEPENDENTS WHERE RELATIONSHIP = 'DAUGHTER';

5.5

SELECT NAME FROM EMPL WHERE EMPCODE NOT IN (SELECT EMPCODE FROM WORK_EXP1 WHERE PRJID = 'SPYDER');

5.6

List the employees who have at least one skill that employees working on project P1 are possessing (set comparison)
SELECT DISTINCT E.NAME
FROM EMPL E
JOIN EMP_SKILLS ES1 ON E.EMPCODE = ES1.EMPNO
WHERE EXISTS (
    SELECT 1
    FROM EMP_SKILLS ES2
    JOIN WORK_EXP1 WE ON ES2.EMPNO = WE.EMPCODE
    WHERE WE.PRJID = 'P1' AND ES2.SKILLID = ES1.SKILLID
);

5.7

SELECT DISTINCT E1.NAME
FROM EMPL E1
JOIN WORK_EXP1 WE1 ON E1.EMPCODE = WE1.EMPCODE
WHERE WE1.PRJID = 'P1'
AND WE1.WORK_EXPERIENCE > ALL (
    SELECT WE2.WORK_EXPERIENCE
    FROM WORK_EXP1 WE2
    WHERE WE2.PRJID = 'P2'
);

5.8

SELECT DISTINCT E.NAME
FROM EMPL E
JOIN WORK_EXP1 WE ON E.EMPCODE = WE.EMPCODE
WHERE (WE.PRJID, WE.CLIENTID) IN (
    SELECT PRJID, CLIENTID
    FROM WORK_EXP1
    WHERE EMPCODE = 100
);

5.9

SELECT NAME FROM EMPL
WHERE EMPCODE NOT IN (
    SELECT EMPCODE
    FROM WORK_EXP1
    WHERE PRJID IN (
        SELECT PRJID
        FROM WORK_EXP1
        WHERE EMPCODE = 106
    )
);

5.10

SELECT PRJ_NAME FROM PRJ_DETAILS P WHERE BUDGET_ALLOCATED > (SELECT SUM(SALARY) FROM EMP E JOIN WORK_EXP W ON E.EMPCODE=W.EMPCODE WHERE W.PRJID=P.PRJID GROUP BY W.PRJID);

5.11

SELECT PRJ_NAME,COUNT(E.EMPCODE) AS NUM_EMP 
FROM PRJ_DETAILS P  
JOIN WORK_EXP W ON P.PRJID=W.PRJID 
JOIN EMP E ON W.EMPCODE=E.EMPCODE 
WHERE W.RATING IN('A','B') 
GROUP BY P.PRJ_NAME ORDER BY NUM_EMP DESC;

5.12

SELECT PRJ_NAME 
FROM PRJ_DETAILS P  
JOIN WORK_EXP W ON P.PRJID=W.PRJID 
GROUP BY P.PRJ_NAME 
HAVING COUNT(DISTINCT W.EMPCODE)>2;

5.13

SELECT NAME,COUNT(DEP_NAME) AS DEP_COUNT 
FROM EMP E JOIN FAMILY_DEPENDENTS F ON E.EMPCODE=F.EMPNO  
GROUP BY F.EMPNO,E.NAME;

SELECT * FROM FAMILY_DEPENDENTS;

5.14

SELECT SUM(PREMIUM) AS TOTAL_PREMIUM, EXTRACT(YEAR FROM POLICYDATE) AS POLICY_YEAR FROM MEDICAL_POLICY GROUP BY EXTRACT(YEAR FROM POLICYDATE);

5.15

WITH SK AS ( 
    SELECT ES.EMPNO, SUM(ES.SKILL_EXPERIENCE) AS SK_EXP FROM EMP_SKILL ES GROUP BY ES.EMPNO 
) 
SELECT E.NAME FROM EMP E JOIN SK S ON E.EMPCODE=S.EMPNO WHERE SK_EXP>20

5.16

CREATE TABLE EMP_PRJ AS 
SELECT NAME AS EMP_NAME, BUDGET_ALLOCATED AS BUDGET, PRJ_NAME AS PROJECT_NAME 
FROM EMP E JOIN PRJ_DETAILS P ON E.EMPCODE=P.LEAD_BY_EMPCODE WHERE LEAD_BY_EMPCODE=110;

5.17

UPDATE EMP 
SET SALARY = CASE 
	WHEN DESIGNATION = 'PROJECT LEADER' THEN SALARY*1.1 
	WHEN DESIGNATION = 'DEVELOPER' THEN SALARY*1.05 
	ELSE SALARY 
END;

5.18

CREATE VIEW EMP_SKILL_EXPERIENCE AS 
SELECT NAME,SKILLNAME,SKILL_EXPERIENCE 
FROM  EMP E JOIN EMP_SKILL ES ON E.EMPCODE=ES.EMPNO 
JOIN SKILL S ON ES.SKILLID=S.SKILLID 
WHERE SKILL_EXPERIENCE>15;

SELECT * FROM EMP_SKILL_EXPERIENCE;

5.19

CREATE VIEW EMP_DESIGNATION AS 
SELECT EMPCODE,NAME,SALARY FROM EMP WHERE DESIGNATION IN ('DEVELOPER','PROJECT LEADER');

SELECT * FROM EMP_DESIGNATION;

5.20

SELECT NAME, (SELECT COUNT(DISTINCT W.PRJID) FROM EMP E JOIN WORK_EXP W ON E.EMPCODE=W.EMPCODE WHERE EX.EMPCODE=E.EMPCODE) AS NUM_PRJ FROM EMP EX;

