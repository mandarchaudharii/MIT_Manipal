REM   Script: WEEK 2
REM   DBS LAB WEEK 2 CODES


1.1

CREATE TABLE EMP ( 
EMPCODE NUMBER(3) CONSTRAINT PK_EMPNO PRIMARY KEY, 
NAME VARCHAR(10), 
QUALIFICATION VARCHAR(7) CONSTRAINT VALID_QUALIF CHECK(QUALIFICATION IN ('BTECH', 'MTECH', 'MSC', 'MCA', 'PHD')), 
PHONE NUMBER(10), 
EMAIL VARCHAR(20) CONSTRAINT EMAIL_DOMAIN CHECK (EMAIL LIKE '%@digisol.com'), 
DESIGNATION VARCHAR(20) CONSTRAINT VALID_DESIGNATION CHECK (DESIGNATION IN ('DEVELOPER', 'PROJECT LEADER', 'PROJECT MANAGER', 'TECHNICAL HEAD', 'PROJECT DIRECTOR', 'PROJECT LEADER', 'CEO')), 
SALARY NUMBER(7) CONSTRAINT SALARY_RANGE CHECK(SALARY BETWEEN 97000 AND 300000));

1.2

CREATE TABLE SKILL ( 
SKILLID CHAR(3) CONSTRAINT UNQ_SKILLID UNIQUE, 
SKILLNAME VARCHAR(20) CONSTRAINT UNQ_SKILLNAME UNIQUE);

1.3

CREATE TABLE EMP_SKILL( 
EMPNO NUMBER(3) CONSTRAINT FK_EMPNO REFERENCES EMP, 
SKILLID CHAR(3) CONSTRAINT FK_SKILLID REFERENCES SKILL(SKILLID) ON DELETE CASCADE, 
SKILL_EXPERIENCE NUMBER(3) CONSTRAINT NEG_VALUE CHECK(SKILL_EXPERIENCE>0));

1.4

CREATE TABLE CLIENT( 
CLIENTID CHAR(3) CONSTRAINT PK_CLIENTID PRIMARY KEY CONSTRAINT STRTSWITH_C CHECK(CLIENTID LIKE 'C__'), 
NAME VARCHAR(10), 
PHONE CHAR(14) CONSTRAINT PHONE_FORMAT CHECK(
    PHONE LIKE '+91-%' OR 
    PHONE LIKE '+81-%' OR 
    PHONE LIKE '+31-%' OR 
    PHONE LIKE '+48-%' OR 
    PHONE LIKE '+44-%'
));

1.5

CREATE TABLE PRJ_DETAILS( 
PRJID CHAR(3) CONSTRAINT PK_PRJID CHECK(PRJID LIKE 'P__') PRIMARY KEY, 
PRJ_NAME VARCHAR(10), 
START_DATE DATE, 
END_DATE DATE, 
CONSTRAINT END_DATE_GARTER_START_DATE CHECK(END_DATE>START_DATE), 
ACTUAL_END_DATE DATE, 
CONSTRAINT ACT_END_DATE CHECK(ACTUAL_END_DATE>=END_DATE), 
LEAD_BY_EMPCODE NUMBER(3) CONSTRAINT FK_LEAD_EMP REFERENCES EMP, 
BUDGET_ALLOCATED NUMBER(10,1), 
ACTUAL_BUDGET NUMBER(10,1));

1.6

CREATE TABLE FAMILY_DEPENDENTS( 
EMPNO REFERENCES EMP, 
DEP_NAME VARCHAR(20), 
PRIMARY KEY(EMPNO,DEP_NAME), 
RELATIONSHIP VARCHAR(16), 
AGE NUMBER(3) CONSTRAINT VALID_AGE CHECK(AGE BETWEEN 1 AND 130));

1.7

CREATE TABLE PAY_CHECK( 
EMPCODE REFERENCES EMP, 
PAY_DATE DATE, 
PRIMARY KEY(EMPCODE,PAY_DATE), 
REGULAR_INCREMENT NUMBER(4) CONSTRAINT VALID_REGU_INCENTIVE CHECK(REGULAR_INCREMENT IN ('2000','3000','5000','7000','9000')), 
PERFORMANCE_INCENTIVE NUMBER(5), 
DA NUMBER(7), 
PF NUMBER(6), 
OTHER_INCENTIVES NUMBER(4), 
ADVANCE_TAX NUMBER(5));

1.8

CREATE TABLE WORK_EXP( 
EMPCODE NUMBER(3) REFERENCES EMP, 
PRJID REFERENCES PRJ_DETAILS, 
PRIMARY KEY(EMPCODE,PRJID), 
WORK_EXPERIENCE NUMBER(3) CHECK(WORK_EXPERIENCE>0), 
CLIENTID CHAR(3) REFERENCES CLIENT ON DELETE CASCADE, 
RATING CHAR(1) CHECK(RATING='A' OR RATING='B' OR RATING='C'));

1.9

CREATE TABLE MEDICAL_POLICY( 
EMPNO REFERENCES EMP, 
POLICYNO VARCHAR(6) CONSTRAINT POLICY_FORMAT CHECK(POLICYNO LIKE 'MED___'), 
CONSTRAINT PK_MED PRIMARY KEY(EMPNO,POLICYNO), 
PREMIUM NUMBER(5) CONSTRAINT NEG_NO CHECK(PREMIUM>0), 
POLICYDATE DATE);

2.1

ALTER TABLE EMP ADD REPORTS_TO CONSTRAINT FK_REPORTS_TO_EMPCODE REFERENCES EMP(EMPCODE);

2.2

ALTER TABLE SKILL MODIFY SKILLID CHECK(SKILLID LIKE 'S%');

2.3

ALTER TABLE EMP_SKILL ADD CONSTRAINT PK_EMPNO_SKILLID PRIMARY KEY (EMPNO,SKILLID);

2.4

ALTER TABLE PRJ_DETAILS 
    MODIFY PRJ_NAME CONSTRAINT UNQ_PRJ_NAME UNIQUE;

2.5

ALTER TABLE CLIENT 
    ADD EMAIL VARCHAR(30) CONSTRAINT VALID_EMAIL CHECK(EMAIL LIKE '%@%.___');

2.6

ALTER TABLE EMP 
    MODIFY PHONE CONSTRAINT UNQ_PHONE UNIQUE;

2.7

ALTER TABLE EMP 
    MODIFY EMAIL CONSTRAINT UNQ_EMAIL UNIQUE;

2.8

ALTER TABLE MEDICAL_POLICY 
    DROP CONSTRAINT PK_MED;

ALTER TABLE MEDICAL_POLICY 
    ADD CONSTRAINT PK_MED PRIMARY KEY(EMPNO,POLICYNO,POLICYDATE);

2.9

ALTER TABLE MEDICAL_POLICY 
    MODIFY PREMIUM CONSTRAINT MIN_AMT CHECK(PREMIUM>1000);

